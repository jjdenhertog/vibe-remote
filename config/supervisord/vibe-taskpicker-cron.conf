# Alternative configuration using supervisord-cron for scheduled execution
# This configuration runs the taskpicker every 5 minutes using cron-like scheduling

[program:vibe-taskpicker-cron]
# Use a wrapper script that runs the taskpicker at intervals
command=/bin/bash -c 'while true; do node %(ENV_PROJECT_ROOT)s/packages/vibe-kanban-taskpicker/dist/index.js; sleep 300; done'

# Working directory
directory=%(ENV_PROJECT_ROOT)s

# Process management
autostart=true                  ; Start automatically when supervisord starts
autorestart=true                ; Restart if the process exits unexpectedly
startretries=3                  ; Number of restart attempts
startsecs=10                    ; Process must stay up for 10 seconds
exitcodes=0,1                   ; Expected exit codes
stopsignal=TERM                 ; Signal to use when stopping
stopwaitsecs=30                 ; Wait time for graceful shutdown

# Logging configuration with rotation
stderr_logfile=/var/log/supervisor/vibe-taskpicker-cron.err.log
stderr_logfile_maxbytes=5MB
stderr_logfile_backups=3
stdout_logfile=/var/log/supervisor/vibe-taskpicker-cron.out.log
stdout_logfile_maxbytes=5MB
stdout_logfile_backups=3

# Environment variables for Claude API and configuration
environment=
    NODE_ENV="production",
    PROJECT_ROOT="%(ENV_PROJECT_ROOT)s",
    CLAUDE_COMMAND="claude",
    VIBE_API_URL="http://localhost:3001",
    TASK_CHECK_INTERVAL="300",
    LOG_LEVEL="info",
    ANTHROPIC_API_KEY="%(ENV_ANTHROPIC_API_KEY)s",
    CLAUDE_API_KEY="%(ENV_CLAUDE_API_KEY)s",
    VIBE_PROJECT_ID="%(ENV_VIBE_PROJECT_ID)s",
    MAX_RETRIES="3",
    RETRY_DELAY="60"

# User and priority
user=root
priority=998

# Process control
process_name=%(program_name)s
numprocs=1
redirect_stderr=false
killasgroup=true
stopasgroup=true